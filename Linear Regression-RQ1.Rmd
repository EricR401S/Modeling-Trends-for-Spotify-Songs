---
title: "Multi Linear Regression-RQ1"
output: pdf_document
date: "2022-11-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Load Libraries
library(ggplot2)
library(psych)
library(corrplot)
library(dplyr)
library(table1)
library(boot)
library(MASS)
library(equatiomatic)
library(jtools)
library(car)
library(kableExtra)
```

```{r}
#Load the data
df1 <- read.csv("https://raw.githubusercontent.com/EricR401S/Modeling-Trends-for-Spotify-Songs/part2/archive/rq1.csv")
```

## Linear Regression Model

Our initial model contained all the 7 predictors selected in the data section above was put through a backward AIC selection to come up with the most pertinent predictors of popularity.

```{r}
linear1 <- lm(popularity ~ acousticness+danceability+energy+instrumentalness+ tempo+ loudness+speechiness , data = df1)
backward <- stepAIC(linear1, trace=FALSE, direction = 'backward')
summ(backward, digits = 4)
```
**Should we think of mean centering these variables?**

A centering attempt.

```{r}
#plot(backward)

#divide first
df1$danceability0.1 <- (df1$danceability)*10
df1$energy0.001 <- (df1$energy)*1000
df1$instrumentalnes0.001 <- (df1$instrumentalness)*1000


#centered
df1$acousticness_centered <- scale(df1$acousticness, scale = FALSE)
df1$danceability0.1_centered <- scale(df1$danceability0.1, scale = FALSE)
df1$energy0.001_centered <- scale(df1$energy0.001, scale = FALSE)
df1$instrumentalness0.001_centered <- scale(df1$instrumentalnes0.001, scale = FALSE)
df1$tempo_centered <- scale(df1$tempo, scale = FALSE)
df1$loudness_centered <- scale(df1$loudness, scale = FALSE)
df1$speechiness_centered <- scale(df1$speechiness, scale = FALSE)

scaled <- lm(popularity ~ acousticness_centered+danceability0.1_centered+energy0.001_centered+instrumentalness0.001_centered+tempo_centered+loudness_centered+speechiness_centered, data = df1)
summ(scaled, digits = 7)
```
```{r}
confinterval_scaled <- confint(scaled, level = 0.95)
kable(confinterval_scaled, caption =  "conf interval table for scaled model") %>% kable_styling(position="center",latex_options = c("hold_position"))
```

**Acousticness** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average acoustiness for a song with a 39 popularity score is `r mean(df1$acousticness)`.We are 95% confident that (x1, x2) contains the true value for acoustiness and for every 1 *unit* increase in acoustiness of a song the average popularity score increases by approximately 1.8 holding all other factors constant.

**Danceability** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average danceability for a song with a 39 popularity score is `r mean(df1$danceability)`.We are 95% confident that (x1, x2) contains the true value for danceability and for every 0.1 *unit* increase in danceability of a song the average popularity score increases by approximately 11.7 holding all other factors constant. 

**Energy** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average energy for a song with a 39 popularity score is `r mean(df1$energy)`.We are 95% confident that (x1, x2) contains the true value for energy and for every 0.001 *unit* increase in energy of a song the average popularity score *decreases by approximately 0.0196 holding all other factors constant* 

**Instrumentalness** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average instrumentalness for a song with a 39 popularity score is `r mean(df1$instrumentalness)`.We are 95% confident that (x1, x2) contains the true value for instrumentalness and for every 0.001 *unit* increase in instrumentalness of a song the average popularity score *decreases by approximately 0.023 holding all other factors constant.* 

**Tempo** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average tempo for a song with a 39 popularity score is `r mean(df1$tempo)`.We are 95% confident that (x1, x2) contains the true value for tempoand for every 1 *unit* increase in tempo of a song the average popularity score decreases by approximately 0.007 holding all other factors constant.

**Loudness** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average loudness for a song with a 39 popularity score is `r mean(df1$loudness)`.We are 95% confident that (x1, x2) contains the true value for loudness and for every 1 *unit* increase in loudness of a song the average popularity score increases by approximately 1 holding all other factors constant. 

**Speechiness** is a significant predictor of a song's popularity score at the $\alpha = 0.05$ significance level ($p< 0.001$).The average speechiness for a song with a 39 popularity score is `r mean(df1$speechiness`.We are 95% confident that (x1, x2) contains the true value for speechiness and for every 1 *unit* increase in speechiness of a song the average popularity score increases by approximately 6.4 holding all other factors constant.


```{r}
#plot(backward)
#df$Duration_centered <- scale(df$Duration, scale = FALSE)
equatiomatic::extract_eq(scaled, use_coefs = TRUE)
```
##Assumptions

1. Linearity : Residual vs predictor graph. 

2. Normal distribution of residuals: Normal Q-Q CURVE : Parses
In the Normal Q-Q curve we can see that the residuals are normally distributed. Apart frrom a few values, the Normal Q-Q curve shows the residuals are fairly normally distributed. Observations whose standardized residuals are greater than 3 in absoulte values seem like possible outliers.


3. Independence of error term: Residual vs fitted curve.


4. homoscedasticity:( Equal variance of error terms) The Scale-Location graphs shows whether residuals are spread equally along the ranges of predictors. It’s good we see a horizontal line with equally (randomly) spread points. 


>Linearity: The residuals vs predictor plot 

```{r}
#Assumptions of model 1
#Linearity residuals vs duration
library(olsrr)
res <- resid(scaled)
plot(df1$acousticness,res)
plot(df1$danceability,res)
plot(df1$energy,res)
plot(df1$instrumentalness,res)
plot(df1$tempo,res)
plot(df1$loudness,res)
plot(df1$speechiness,res)
abline(0,0)
#Independence and equal variance of error terms
ols_plot_resid_fit(scaled)

```

> Independence of error terms : The points on the residual vs fitted plot are randomly spread 

```{r}
#Independence and equal variance of error terms
ols_plot_resid_fit(backward)
```

> Equal Variance of error terms : The points on the residual vs fitted plot are equally spread around the ab line(0,0) therefore we can conclude that there is homoscedasticity.

```{r}
#Independence and equal variance of error terms
ols_plot_resid_fit(backward)
```

> Normality of residuals: The points on the quantile-quantile plot are clustered along the 45 degree line so there are no clear violations of this assumption.

```{r}
ols_plot_resid_hist(backward)
#Normality of residuals
ols_plot_resid_qq(backward)
```

## Checking Multicollinearity

The model appears to have no issues with multicollinearity as seen below all the VIF values are below 5 therefore the potential multicollinearity between energy and acoustiness is not there. 
```{r}
test <- vif(scaled)
kable(test, caption =  "VIF table") %>% kable_styling(position="center",latex_options = c("hold_position"))
```


## Outliers and Influential point - Cooks distance
```{r}
ols_plot_cooksd_bar(backward)
```

```{r}
ols_plot_resid_lev(backward)
```


## Potential Limitations 

## Conclusion 
  

```{r}
#ols_plot_resid_lev(backward[])

```



#Methods
Describe the process you used to conduct analysis. This includes EDA and any relevant
data cleaning information (e.g., did you exclude missing values? If so, how many? Did you collapse categories for any variables?) 
Then describe the models you fit, and any changes you made to improve model fit (e.g., did you exclude any influential points? Did you do have to address multicollinearity issues? Did you transform any variables?). 

Also describe model diagnostics. The organization of this section may depend on your particular dataset/analysis, but you may want to break it into subsections such as “Data,” “Models,” and “Model assessment.” Note that you do not present any results in this section.